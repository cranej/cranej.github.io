<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>春江花月夜 - Unable to find openssl when compiling Erlang/OTP from source on Arch Linux</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
          <div class="wrapper">
            <div id="logo">
                <a href="../">春江花月夜</a>
            </div>
            <div id="navigation">
                <a href="../about.html">About</a>
                <a href="../references.html">Reference</a>
            </div>
            <div style="clear:both;"></div>
          </div>
        </div>

        <div id="content" class="wrapper">
            <h1>Unable to find openssl when compiling Erlang/OTP from source on Arch Linux</h1>
<div class="info">
    Posted on May 29, 2017
    
</div>

<p>One important reason to choose Arch Linux is that you can always get newest versions of software:</p>
<blockquote>
<p>Arch Linux strives to maintain the latest stable release versions of its software.</p>
</blockquote>
<p>However, today I learned that Arch Linux went <em>farther than stable versions</em> - currently in Arch Linux repository, the available version of Erlang is ‘20-rc1’ which is not a stable version. Then I have troubles when trying <a href="http://nerves-project.org/">nerves-project</a> on my newly bought Raspberry Pi. Nerves-project did a great job though - it supports the <strong>real</strong> latest <strong>stable</strong> version of Erlang - 19.3.</p>
<p>I have to compile Erlang 19.3 from source on my laptop. <a href="https://github.com/kerl/kerl">Kerl</a> is the tool recommended by Erlang official site to install and manage different versions of Erlang/OTP easily. So no reason to compile it from scratch. But <code>kerl</code> seems has problem with <code>open-ssl</code> installation on Arch Linux, as it complains the following:</p>
<pre><code>APPLICATIONS DISABLED (See: /home/xxx/.kerl/builds/19.3/otp_build_19.3.log)
 * crypto         : No usable OpenSSL found
 * odbc           : ODBC library - link check failed
 * ssh            : No usable OpenSSL found
 * ssl            : No usable OpenSSL found</code></pre>
<p>I have tried to specify <code>KERL_CONFIGURE_OPTIONS=--with-ssl=/usr/lib/openssl-1.0</code> with <code>kerl</code>, but had no luck. After some searches on the web, I found <a href="https://bbs.archlinux.org/viewtopic.php?id=226174">this</a> helpful article, although it’s to solve the problem when installing Erlang via <code>asdf</code>, the cause is the same:</p>
<blockquote>
<p>The issue is definitely that Erlang/OTP does not build with OpenSSL 1.1<br />
ArchLinux openssl 1.0 package directory structure does not play well with erlang –with-ssl flag. The directory structure should be something like DIR/lib/libssl.so for it to work with –with-ssl=DIR, but it is installed at /usr/lib/openssl-1.0/libssl.so</p>
</blockquote>
<p>And finally got Erlang 19.3 complied by manually restructuring <code>open-ssl</code> directory:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">mkdir</span> -p <span class="va">$HOME</span>/.openssl-1.0
<span class="bu">cd</span> <span class="va">$HOME</span>/.openssl.1-0
<span class="fu">ln</span> -sf /usr/lib/openssl-1.0 lib
<span class="fu">ln</span> -sf /usr/include/openssl-1.0 include</code></pre></div>
<p>And then explicitly specify <code>--with-ssl</code> option:</p>
<pre><code>KERL_CONFIGURE_OPTIONS=&quot;--with-ssl=$HOME/.openssl-1.0&quot; kerl build 19.3 19.3</code></pre>
<p>Hope this is helpful.</p>

        </div>
        <div id="footer">
            <div class="wrapper">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </div>
        </div>
    </body>
</html>
